#!/usr/bin/make -f
# vim:ts=4:sw=4
#
# Copyright (c) 2011-2014 Casper Ti. Vector
# Public domain.

SELF = utils/dist
VER_GEN = $(if $(MINORVER),$(MAJORVER)$(1)$(MINORVER),$(MAJORVER))
VERSION = $(call VER_GEN,)

dist:
	$(SELF) distclean
	$(SELF) dist-ctan
	$(SELF) clean

doc-dist: doc/
	# Make the directory.
	mkdir -p $@/
	# Example.
	make toutf8
	cp -r doc/example/ $@/example-utf8
	make togbk
	cp -r doc/example/ $@/example-gbk
	make toutf8
	# Readme.
	cd doc/readme/ && make && make clean
	mv -f doc/readme/$(TITLE).pdf $@/README.pdf
	cp -r doc/readme/ $@/readme-src

dir-tds: $(TITLE)-tds
$(TITLE)-tds: tex/ doc-dist README
	mkdir -p $@/tex/latex/ $@/doc/latex/
	cp -r tex/ $@/tex/latex/$(TITLE)
	cp -r doc-dist/ $@/doc/latex/$(TITLE)

dist-tds: $(TITLE)-$(VERSION).tds.zip
$(TITLE)-$(VERSION).tds.zip: $(TITLE)-tds
	cd $< && zip -rT ../$@ tex/ doc/

dir-ctan: $(TITLE)-ctan
$(TITLE)-ctan: tex/ doc-dist README $(TITLE)-$(VERSION).tds.zip
	mkdir -p $@/$(TITLE)/
	cp -r tex/ README $@/$(TITLE)/
	cp -r doc-dist/ $@/$(TITLE)/doc
	mv -f $(TITLE)-$(VERSION).tds.zip $@/

dist-ctan: $(TITLE)-$(VERSION).zip
$(TITLE)-$(VERSION).zip: $(TITLE)-ctan
	cd $< && zip -rT ../$@ $(TITLE)/ $(TITLE)-$(VERSION).tds.zip

clean:
	cd doc/readme/ && make distclean
	cd doc/example/ && make distclean
	rm -rf $(TITLE)-ctan/ $(TITLE)-tds/ doc-dist/

distclean:
	$(SELF) clean
	rm -rf $(TITLE)-$(VERSION).tds.zip  $(TITLE)-$(VERSION).zip

