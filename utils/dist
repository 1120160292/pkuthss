#!/usr/bin/make -f
# vim:ts=4:sw=4
#
# Copyright (c) 2011-2012 Casper Ti. Vector
# Public domain.

VER_GEN = $(if $(MINORVER),$(MAJORVER)$(1)$(MINORVER),$(MAJORVER))
VERSION = $(call VER_GEN,)

dist:
	make distclean
	make doc-dist
	make doc-pdf
	make dist-ctan
	make dist-tds
	make clean

doc-dist: doc/
	mkdir -p $@/
	make toutf8lf
	cp -r doc/ $@/utf8lf
	make togbkcrlf
	cp -r doc/ $@/gbkcrlf
	make toutf8lf

doc-pdf: doc/
	cd doc && make && make clean
	mv -f doc/$(TITLE).pdf doc-dist/

dir-ctan: $(TITLE)-ctan
$(TITLE)-ctan: tex/ doc/ README
	mkdir -p $@/$(TITLE)
	cp -r tex/ $@/$(TITLE)/
	cp -r doc-dist/ $@/$(TITLE)/doc
	cp README $@/$(TITLE)/

dist-ctan: $(TITLE)-$(VERSION)-ctan.zip
$(TITLE)-$(VERSION)-ctan.zip: $(TITLE)-ctan
	cd $^ && zip -rT ../$@ $(TITLE)/

dir-tds: $(TITLE)-tds
$(TITLE)-tds: tex/ doc/ README
	mkdir -p $@/$(TITLE)/tex/latex/ $@/$(TITLE)/doc/latex/
	cp -r tex/ $@/$(TITLE)/tex/latex/$(TITLE)
	cp -r doc-dist/ $@/$(TITLE)/doc/latex/$(TITLE)

dist-tds: $(TITLE)-$(VERSION)-tds.zip
$(TITLE)-$(VERSION)-tds.zip: $(TITLE)-tds
	cd $^ && zip -rT ../$@ $(TITLE)/

clean:
	cd doc/ && make distclean
	rm -rf $(TITLE)-ctan/ $(TITLE)-tds/ doc-dist/

distclean:
	make clean
	rm -rf $(TITLE)-$(VERSION)-ctan.zip  $(TITLE)-$(VERSION)-tds.zip

