% vim:ft=tex:ts=2:sw=2
%
% Peking University dissertation document class
%
% Copyright (c) 2008-2009 solvethis.
% Copyright (c) 2010-2011 Casper Ti. Vector.
%
% This work may be distributed and/or modified under the conditions of the
% LaTeX Project Public License, either version 1.3 of this license or (at
% your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX version
% 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% The current maintainer of this work is Casper Ti. Vector.
%
% This work consists of the following files:
%   pkuthss.cls
%   pkuthss-option.def
%   pkuthss-common.def
%   pkuthss-gbk.def
%   pkuthss-utf8.def
%   pkuthss-extra.sty

% pkuthss-extra.sty 中包含了一些常用的额外设定。
\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{pkuthss-extra}
	[2011/01/26 v1.3 alpha1 Extra settings for pkuthss document class]

% 例如：
% \@extraopt{space} 最终被扩展为：
%   \newif\ifpkuthss@extra@space \pkuthss@extra@spacetrue
%   \DeclareOption{space}{\pkuthss@extra@spacetrue}
%   \DeclareOption{nospace}{\pkuthss@extra@spacefalse}
\def\@extraopt#1{
	\expandafter\newif\csname ifpkuthss@extra@#1\endcsname
	\csname pkuthss@extra@#1true\endcsname
	\expandafter\DeclareOption{#1}{\csname pkuthss@extra@#1true\endcsname}
	\expandafter\DeclareOption{no#1}{\csname pkuthss@extra@#1false\endcsname}
}
% 是否采用一些常用的版式设定。
\@extraopt{space}
% 是否采用一些常用的额外字体设置。
\@extraopt{font}
% 是否采用一些和目录、参考文献和索引等相关的常见设置。
\@extraopt{tbi}
% 是否默认使引用标记成为上标。
\@extraopt{cite}
% 是否在生成的 pdf 文档中使用彩色的超链接。
\@extraopt{color}
% 是否自动根据设定的论文文档信息决定生成的 pdf 文档的文档信息。
\@extraopt{meta}
\ProcessOptions\relax

\ifpkuthss@extra@space
	% 此宏包提供了方便的命令用于定制枚举环境。
	\RequirePackage{enumitem}

	% 设置页芯居中。
	\geometry{centering}
	% 设定行距。
	\renewcommand{\baselinestretch}{1.5}

	\AtEndOfPackage{
		% 枚举环境中每个条目的内容较少时，条目往往显得稀疏。此处将原 itemize、
		% enumerate 和 description 三个枚举环境中的 \itemsep 改为零，并新定义了
		% nitem、nenum、ndesc 三个枚举环境提供原来三个环境的相应功能。
		\newlist{nitem}{itemize}{4}
		\newlist{nenum}{enumerate}{4}
		\newlist{ndesc}{description}{4}
		\setitemize{noitemsep}
		\setenumerate{noitemsep}
		\setdescription{noitemsep}

		% 参考文献的条目间隔往往显得较大，此处将其 \itemsep 改为零。
		\let\tmp@bibliography\thebibliography
		\renewcommand{\thebibliography}[1]%
			{\tmp@bibliography{#1}\setlength{\itemsep}{0pt}}
	}
\fi

\ifpkuthss@extra@font
	% 使得打字机粗体可以被使用。
	\RequirePackage{lmodern}
	% 产生 originauth.tex 里的 \square。
	\RequirePackage{amssymb}
\fi

\ifpkuthss@extra@tbi
	% 在生成的 pdf 中手动加入“目录”的书签，但不在目录中显示“目录”自己。
	\RequirePackage{tocbasic}
	\BeforeTOCHead{\pdfbookmark[1]{\contentsname}{thecontents}}
	% 将参考文献、索引（如果存在）等加入目录中，但不包括“目录”本身。
	\usepackage[nottoc]{tocbibind}
\fi

\ifpkuthss@extra@cite
	% 使引用标记默认成为上标。
	\RequirePackage{cite}
	\newcommand{\ncite}[1]{[\citen{#1}]}
	\renewcommand{\cite}[1]{\mbox{}\textsuperscript{\ncite{#1}}\mbox{}}
\fi

\AtEndOfPackage{
	\ifpkuthss@extra@color
		% 在生成的 pdf 中使用彩色的超链接。
		\hypersetup{colorlinks=true}
	\else
		% 将所有超链接改为黑色，以免打印时相应部分颜色过淡。
		\hypersetup{colorlinks=false, pdfborder={0 0 0}}
	\fi
}

\AtBeginDocument{
	\ifpkuthss@extra@meta
		% 在生成标题页时自动设定 pdf 文档的文档信息。
		\let\tmp@maketitle\maketitle
		\renewcommand\maketitle{
			% 注意 \hypersetup 一定要在原 \maketitle 之前，否则会失效。
			\hypersetup{
				pdfauthor={\@eauthor},pdftitle={\@etitle},
				pdfsubject={\euniversity\ \ethesisname},pdfkeywords={\@ekeywords}
			}
			\tmp@maketitle
		}
	\fi
}

\endinput
