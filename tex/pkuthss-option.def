% vim:ft=tex:ts=2:sw=2
%
% Peking University dissertation document class
%
% Copyright (c) 2008-2009 solvethis.
% Copyright (c) 2010-2011 Casper Ti. Vector.
%
% This work may be distributed and/or modified under the conditions of the
% LaTeX Project Public License, either version 1.3 of this license or (at
% your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX version
% 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% The current maintainer of this work is Casper Ti. Vector.
%
% This work consists of the following files:
%   pkuthss.cls
%   pkuthss-option.def
%   pkuthss-common.def
%   pkuthss-gbk.def
%   pkuthss-utf8.def
%   pkuthss-extra.sty

% pkuthss-option.cls 包含了文档类中的一些选项设定，以及对其它宏包、文档类的
% 调用。

% 处理编码选项。
\newif\ifpkuthss@opt@gbk \pkuthss@opt@gbktrue
\DeclareOption{GBK}{\pkuthss@opt@gbktrue\PassOptionsToClass{GBK}{ctexbook}}
\DeclareOption{UTF8}%
	{\pkuthss@opt@gbkfalse\PassOptionsToClass{UTF8}{ctexbook}}
% 是否采用默认的额外设置。
\newif\ifpkuthss@opt@extra \pkuthss@opt@extratrue
\DeclareOption{extra}{\pkuthss@opt@extratrue}
\DeclareOption{noextra}{\pkuthss@opt@extrafalse}
% 将其余的文档类参数全部传递给 ctexbook 文档类。
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{ctexbook}}
\ProcessOptions\relax

% 此文档类以 ctexbook 为基础，设定页面尺寸为 A4，默认字号为小四号。
% CJKfntef 宏包提供了 \maketitle 中用到的 \CJKunderline 命令。
% hyperref 宏包为文章中的目录、交叉和索引等自动产生超链接，并自动生成书签。
% fancyhdr 宏包提供了方便使用的命令用于设置页眉、页脚。
\LoadClass[fntef,a4paper,hyperref,fancyhdr,cs4size]{ctexbook}[2009/10/20]
% 此宏包提供对 key=val 格式设置的支持。
\RequirePackage{keyval}
% 此宏包提供图形支持。
\RequirePackage{graphicx}[1999/02/16]
% 此宏包提供了方便使用的命令用于设置页面布局。
\RequirePackage{geometry}
% 使某些细节（如脚注、抄录）处的空间安排更美观。
\RequirePackage{setspace}
% 是否采用默认的额外设置。
\ifpkuthss@opt@extra\RequirePackage{pkuthss-extra}\fi

\ifxetex
	\ifpkuthss@opt@gbk
		% 不支持非用 XeLaTeX 编译非 UTF-8 的文档。
		\ClassError{pkuthss}
			{XeLaTeX compilation is not supported without UTF-8}
			{%
				XeLaTeX compilation without UTF-8 is very problematic.\MessageBreak
				Therefore please use UTF-8 encoding for the LaTeX code.%
			}
	\fi
\else
	% 忽略 CJK 文字之间的空白而保留（CJK 文字与英文之间等的）其它空白。
	% （XeCJK 自动控制这些空白，故用 XeLaTeX 编译时不需要这个宏包。）
	\RequirePackage{CJKspace}
\fi

\AtEndOfClass{%
	% 设定各处标题的内容。
	\ifpkuthss@opt@gbk\input{pkuthss-gbk.def}
	\else\input{pkuthss-utf8.def}\fi
}

\endinput
